<!DOCTYPE html>
<!--
# Copyright (C) 2015 INRA
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, either version 3 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program.  If not, see <http://www.gnu.org/licenses/>.
-->
<html>
	<head>
		<title>FrogsFunc place seqs</title>
		<meta charset="UTF-8">
		<meta name="version" content="5.0.0">
		<!-- CSS -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.1.1/css/bootstrap.css"></link>
		<link rel="stylesheet" href="https://cdn.datatables.net/1.10.19/css/dataTables.bootstrap4.min.css"></link>
		<link rel="stylesheet" href="https://cdn.datatables.net/searchpanes/1.4.0/css/searchPanes.dataTables.min.css"></link>
		<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
		<link href="https://cdn.datatables.net/select/1.3.3/css/select.dataTables.min.css" rel="stylesheet">
		<style type="text/css">
			:root {
				--frogsColor: #8EADAC; 
				--frogsColorHover: #648a89;
				--frogsColorShadow: #555;
				--frogsColor2: #DE9F73;
				--frogsColorZoomHighCharts: rgb(222,159,115,0.25);
			}
			.frogsversion{
				position: absolute;
				right: 5%;
				color: var(--frogsColor);
				font-style: italic;
				font-size: smaller;
			}
			.frogsversion > a{
				border: none !important;
			}
			#js-alert {
				width: 90%;
				margin-right: auto;
				margin-left: auto;
			}
			#content {
				width: 90%;
				margin-right: auto;
				margin-left: auto;
			}
			.clear {
				clear: both;
				height: 0px;
				width: 100%;
				float: none !important;
			}
			.page-item.active .page-link {
				z-index: 1;
				color: #fff;
				background-color: var(--frogsColor);
				border-color: var(--frogsColor);
			}
			.btn {
				color: #fff;
				border: var(--frogsColor);
				background-color: var(--frogsColor);
			}
			.btn:focus, .btn:active {
				outline: none !important;
				box-shadow: none !important;
			}
			.btn:hover{
				color: #fff;
				border: var(--frogsColorHover);
				background-color: var(--frogsColorHover);
			}
			.pb-2, .py-2 {
				padding-bottom: 1.5rem !important;
				margin-bottom: 2rem !important;
				margin-top: 4rem !important;
			}
			.pb-2-first{
				padding-bottom: 1.5rem !important;
				margin-bottom: 2rem !important;
				margin-top: 1rem !important;
			}
			.nav-tabs .nav-link.active, .nav-tabs .nav-item.show .nav-link{
				color: #fff;
				background-color: var(--frogsColor);
				border-color: #dee2e6 #dee2e6 #fff;
			}
			a {
				color: var(--frogsColor);
			}
			a:hover{
				color: var(--frogsColorHover);
			}
			.page-link{
				color: var(--frogsColor);
			}
			.page-link:hover{
				
			}
			.page-link:not(:disabled):not(.disabled) {
				color: var(--frogsColor);
			}
			.page-item.active .page-link {
				color: #fff;
			}
			.highcharts-button > path{
				stroke:#fff !important;
				fill: var(--frogsColor) !important;
			}
			g.highcharts-button{
				cursor:pointer !important;
			}
			g.highcharts-button:hover{
				color: #fff;
				border: var(--frogsColorHover);
				background-color: var(--frogsColorHover);
				background-color: var(--frogsColorHover);
				cursor:pointer !important;
			}
			tbody > tr.selected, table.dataTable tbody > tr > .selected {
				background-color: var(--frogsColor) !important;
			}
			div.dtsp-panesContainer div.dtsp-searchPanes div.dtsp-searchPane div.dtsp-selected {
				border: 2px solid #e1e5e8;
			}
						.highcharts-figure,
			.highcharts-data-table table {
				min-width: 360px;
				max-width: 800px;
				margin: 1em auto;
			}

			.highcharts-data-table table {
				font-family: Verdana, sans-serif;
				border-collapse: collapse;
				border: 1px solid #ebebeb;
				margin: 10px auto;
				text-align: center;
				width: 100%;
				max-width: 500px;
			}

			.highcharts-data-table caption {
				padding: 1em 0;
				font-size: 1.2em;
				color: var(--frogsColorShadow);
			}

			.highcharts-data-table th {
				font-weight: 600;
				padding: 0.5em;
			}

			.highcharts-data-table td,
			.highcharts-data-table th,
			.highcharts-data-table caption {
				padding: 0.5em;
			}

			.highcharts-data-table thead tr,
			.highcharts-data-table tr:nth-child(even) {
				background: #f8f8f8;
			}

			.highcharts-data-table tr:hover {
				background: #f1f7ff;
			}
		</style>
		<!-- JS -->
		<script type="text/javascript" src="https://code.jquery.com/jquery-2.1.3.min.js"></script>
		<script type="text/javascript" src="https://code.highcharts.com/8.2.0/highcharts.js"></script>
		<script type="text/javascript" src="https://code.highcharts.com/8.2.0/modules/exporting.js"></script>
		<script type="text/javascript" src="https://code.highcharts.com/modules/export-data.js"></script>
		<!--<script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/jquery.dataTables.min.js"></script>
		<script type="text/javascript" src="https://cdn.datatables.net/1.10.19/js/dataTables.bootstrap4.min.js"></script>
		<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>-->
		
		<script type="text/javascript" src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
		<script type="text/javascript" src="https://cdn.datatables.net/searchpanes/1.4.0/js/dataTables.searchPanes.min.js"></script>
		<script type="text/javascript" src="https://cdn.datatables.net/select/1.3.3/js/dataTables.select.min.js"></script>
		<script type="text/javascript">
			/*
			 * HTMLTable.js 0.1.0 - HTMLTable Library
			 *
			 * Copyright (c) 2015 Escudie Frederic
			 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
			 */
			function HTMLtable(e){var t,r,n=e,a=";";this.deleteColumns=function(e){for(var a=n.getElementsByTagName("tr"),o=0;o<a.length;o++){s=0;var i=a[o].getElementsByTagName("td");0==i.length&&(i=a[o].getElementsByTagName("th"));for(var v=0,s=0;s<t[1];s++)if(!r[o][s]){var f=i[v].getAttribute("colspan");if(null!=f)for(var m=0;f>m;m++){if(in_array(s+m,e)){var u=i[v].getAttribute("colspan");u-1==0?i[v].removeAttribute("colspan"):i[v].setAttribute("colspan",u-1)}if(null==i[v].getAttribute("colspan")){var h=i[v];a[o].removeChild(h),v--}}else if(in_array(s,e)){var h=i[v];a[o].removeChild(h),v--}v++}}l(),g()},this.filter=function(e,a){var l=new RegExp(e),g=new Array;null!=a&&a||(g.c0=!0);for(var o=n.getElementsByTagName("tr"),i=0;i<o.length;i++){f=0;var v=o[i].getElementsByTagName("td");if(0!=v.length)for(var s=0,f=0;f<t[1];f++)r[i][f]||(l.test(v[s].innerHTML)&&(g["c"+f]=!0),s++)}for(var m=new Array,u=0;u<t[1];u++)void 0===g["c"+u]&&m.push(u);this.deleteColumns(m)},this.getModel=function(){return n};var l=function(){for(var e=0,r=0,a=n.getElementsByTagName("tr"),l=0;l<a.length;l++){var g=0;e++;var o=a[l].getElementsByTagName("td");0==o.length&&(o=a[l].getElementsByTagName("th"));for(var i=0;i<o.length;i++){var v=o[i].getAttribute("colspan");g+=null==v?1:parseInt(v)}g>r&&(r=g)}t=new Array(2),t[0]=e,t[1]=r},g=function(){r=new Array(t[0]);for(var e=0;e<t[0];e++){r[e]=new Array(t[1]);for(var a=0;a<t[1];a++)r[e][a]=!1}for(var l=n.getElementsByTagName("tr"),g=0;g<l.length;g++){v=0;var o=l[g].getElementsByTagName("td");0==o.length&&(o=l[g].getElementsByTagName("th"));for(var i=0,v=0;v<t[1];v++)if(!r[g][v]){var s=0,f=0,m=o[i].getAttribute("rowspan");null!=m&&(s=parseInt(m)-1);var u=o[i].getAttribute("colspan");null!=u&&(f=parseInt(u)-1);for(var h=s;h>=0;h--)for(var y=f;y>=0;y--)(0!=h||0!=y)&&(r[g+h][v+y]=!0);i++}}};this.replace=function(e,a,l){var g=new RegExp(e);null==a&&(a=""),null==l&&(l="");for(var o=n.getElementsByTagName("tr"),i=0;i<o.length;i++){f=0;var v=o[i].getElementsByTagName("td");if(0!=v.length)for(var s=0,f=0;f<t[1];f++)if(!r[i][f]){var m=g.exec(v[s].innerHTML);null!=m&&(void 0===m[1]&&(m[1]=""),v[s].innerHTML=a+m[1]+l),s++}}},this.toCSV=function(){for(var e="",l=n.getElementsByTagName("tr"),g=0;g<l.length;g++){var o=l[g].getElementsByTagName("td");0==o.length&&(o=l[g].getElementsByTagName("th"));for(var i=0,v=0;v<t[1];v++)r[g][v]||(e+=o[i].innerHTML,i++),e+=a;e=e.substr(0,e.length-1)+"\n"}return e},l(),g()}var in_array=function(e,t){for(var r in t)if(t[r]==e)return!0;return!1};
			
			/*
			 * dataTableExtractor.plugin.js 0.1.0 - datatableExport Library
			 *
			 * Copyright (c) 2015 Escudie Frederic
			 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
			 */
			!function(t){t.fn.datatableExport=function(a){var e={anchor_id:t(this).attr("id"),table_id:null,csv_separator:";",omitted_columns:[]},n=t.extend(e,a);if(!t(this).length)throw"The element where the datatableExport is called does not exist.";if(void 0==n.anchor_id)throw"The datatableExport plugin must be called on an element with id.";if(null==n.table_id)throw"You must set the table_id parameter in datatableExport plugin.";if(!t("#"+n.table_id))throw"The datatable '#"+n.table_id+"' cannot be retieve in DOM.";return this.each(function(){var a=t(this);a.on("click",function(){t.fn.datatableExport.csv(n.anchor_id,n.table_id,n.csv_separator,n.omitted_columns)})})},t.fn.datatableExport.cleanCellMarkup=function(a,e){t.parseHTML(e);t("#"+a).append('<div class="hidden data-tmp">'+e+"</div>"),t("#"+a+" .data-tmp").find("input").each(function(){var a="";a=t(this).is(":checkbox")?t(this).is(":checked")?"true":"false":t(this).val(),t(this).replaceWith(a)});var n=t("#"+a+" .data-tmp").text();return t("#"+a+" .data-tmp").remove(),n},t.fn.datatableExport.csv=function(a,e,n,i){var l="",r=t("#"+e).DataTable(),d=t("#"+e+" thead")[0],o=new HTMLtable(d.cloneNode(!0));o.deleteColumns(i),l+=o.toCSV();var c=r.rows().data();t.each(c,function(e,n){for(var r="",d=0;d<n.length;d++)-1==t.inArray(d,i)&&(r+='"'+t.fn.datatableExport.cleanCellMarkup(a,n[d])+'";');""!=r&&(r=r.slice(0,-1)),l+=r+"\n"}),t("#"+a+"-extract-csv").length||t("#"+a).append('<a id="'+a+'-extract-csv" href="data:text/csv;charset=UTF-8,'+encodeURI(l)+'" download="data.csv" style="display:none;"></a>'),t("#"+a+"-extract-csv")[0].click()}}(jQuery);
		</script>
		<script type="text/javascript">
			/**
			Colors
			*/
			var root = document.documentElement;
			var style = getComputedStyle(root);
			var frogsColor = style.getPropertyValue('--frogsColor');
			var frogsColor2 = style.getPropertyValue('--frogsColor2');
			var frogsColorZoomHighCharts = style.getPropertyValue('--frogsColorZoomHighCharts');
			var frogsColorHover = style.getPropertyValue('--frogsColorHover');
			/**
			 Data from HTML
			*/
			var frogs_version = ###FROGS_VERSION### ;
			var frogs_tool = ###FROGS_TOOL### ;
			var detection_categories = ###DETECTION_CATEGORIES### ;
			var detection_series = ###DETECTION_DATA### ;
			var remove_info = ###REMOVE_DATA### ;
			/**
			 * Returns the string representation of the number. 
			 * @param pValue {Float} The number to process.
			 * @return {String} The string representation (example: 12856892.11111 => 12,856,892.11).
			 */
		    var numberDisplay = function( pValue ){
		    	var new_val = "" ;
		    	if( ("" + pValue + "").indexOf(".") != -1 ){
		    		new_val = pValue.toFixed(2).replace(/(\d)(?=(\d{3})+\b)/g, '$1,');
		    	} else {
		    		new_val = pValue.toFixed().replace(/(\d)(?=(\d{3})+\b)/g, '$1,');
		    	}
		        return new_val ;
		    }
		    
			/**
			 * Returns the HTML table representation of the data. 
			 * @param pTitle {String} The title of the table.
			 * @param pCategories {Array} The title of each column.
			 * @param pData {Array} 2D matrix with row and column data.
			 * @return {String} The HTML table representation.
			 */
			var table = function( pTitle, pCategories, pData  ) {
				// Header
				var table_header = '' ;
				var table_header_line = "" ;
				for(var idx = 0 ; idx < pCategories.length ; idx++){
					table_header_line += "      <th>" + pCategories[idx] + "</th>\n" ;
				}
				table_header += "    <tr>\n" + table_header_line + "    </tr>\n" ;
				table_header = "  <thead>\n" + table_header + "  </thead>\n" ;
				
				// Body
				var table_body = '' ;
				for(var data_idx = 0 ; data_idx < pData.length ; data_idx++){
					var table_body_row = "" ;
					for(var category_idx = 0 ; category_idx < pCategories.length ; category_idx++){
						if( typeof pData[data_idx][category_idx] === "number" ) {
							table_body_row += "      <td>" + numberDisplay(pData[data_idx][category_idx]) + "</td>\n" ;
						} else {
							table_body_row += "      <td>" + pData[data_idx][category_idx] + "</td>\n" ;
						}
					}
					table_body += "    <tr>\n" + table_body_row + "    </tr>\n" ;
				}
				table_body = "  <tbody>\n" + table_body + "  </tbody>\n" ;

				return '<table class="table table-striped table-bordered">\n' + table_header + table_body + "</table>\n" ;
			}
			 
			 /**
			  * Returns hash use to init HightChart object (without 'type'). 
			  * @param pTitle {String} The title of the chart.
			  * @param pXTitle {String} The xAxis title.
			  * @param pYTitle {String} The yAxis title.
			  * @param pXCategories {Array} The title of each category (x scale labels).
			  * @param pData {Array} The HightChart series.
			  * @return {Hash} The hash.
			  * @warning This method use HightChart xAxis.categories.
			  */
			 var chartplot_pie = function( pTitle, pXTitle, pYTitle, pXCategories, pData ) {
			 	var chart = {
			 	        title: {
			 	            text: pTitle
			 	        },
			 	        xAxis: {},
			 	        yAxis: {
			 	            title: {
			 	                text: pYTitle
			 	            }
			 	        },
			 	        series: pData,
			 	        credits: {
			 	        	enabled: false
			 	        },
			 	        exporting:{buttons: {contextButton: { symbol: 'download' }}},
                    buttons: {contextButton: {menuItems: ['downloadPNG', 'downloadSVG']}},
                    navigation: {
						buttonOptions: {
							theme: {
								r: 4,
								fill: frogsColor,
								states: {
									hover: {
										fill: 'rgb(100, 138, 137)',
										stroke: frogsColor
									},
									select: {
										stroke: frogsColor,
										fill: 'rgb(100, 138, 137)',
									}
								}
							}
						}
					}
			 	}
			 	if( pXCategories != null ){
			 		chart['xAxis']['categories'] = pXCategories ;
			 	}
			 	if( pXTitle != null ){
			 		chart['xAxis']['title'] = { text: pXTitle } ;
			 	}
			 	if( pData.length <= 1 ) {
			 		chart['legend'] = {'enabled': false};
			 	} else {
			 		chart['legend'] = {'enabled': true};
			 	}
			 	return chart ;
			 }

			 var chartplot_line = function( pTitle, pXTitle, f_pYTitle, s_pYTitle, max_fY, max_sY, pXCategories, pData ) {
			 	var chart = {
			 	        title: {
			 	            text: pTitle
			 	        },
			 	        xAxis: {
			 	        	allowDecimals: true
			 	        },
			 	        yAxis: [{
			 	            title: {
			 	                text: f_pYTitle,
			 	                style: {
                					color: Highcharts.getOptions().colors[1]
            					}
			 	            },
			 	            dataSorting: {
        					enabled: true
    						},
			 	            max: max_fY,
			 	            startOnTick: false,
			 	            endOnTick:false
			 	        } , {
			 	        	//Secondary Y axis
			 	        	gridLineWidth: 0,
			 	        	opposite: true,
			 	        	title: {
			 	        		text: s_pYTitle,
			 	        		style: {
                					color: Highcharts.getOptions().colors[0]
            					}
			 	        	},
			 	        	labels: {
            					style: {
                					color: Highcharts.getOptions().colors[0]
            						}
       							},
       						max: max_sY
			 	        }] ,
			 	        tooltip: {
			 	        	shared: true
			 	        },

			 	        series: pData,
			 	        credits: {
			 	        	enabled: false
			 	        }
			 	}
			 	if( pXCategories != null ){
			 		chart['xAxis']['categories'] = pXCategories ;
			 	}
			 	if( pXTitle != null ){
			 		chart['xAxis']['title'] = { text: pXTitle } ;
			 	}
			 	if( pData.length <= 1 ) {
			 		chart['legend'] = {'enabled': false};
			 	} else {
			 		chart['legend'] = {'enabled': true};
			 	}
			 	return chart ;
			 }
			 
			var pie_param = function( pTitle, pData, unity ) {
				var series = [{
	                type: 'pie',
	                name: unity,
	                data: pData
            	}]
				var plot = chartplot_pie( pTitle, null, null, null, series );
				plot['tooltip'] = {
		            pointFormat: '{series.name}: <b>{point.percentage:.1f}%</b>'
		        };
				plot['plotOptions'] = {
		            pie: {
		                allowPointSelect: true,
		                cursor: 'pointer',
		                dataLabels: {
		                    enabled: true,
		                    useHTML : true,
		                    formatter: function () {
        		                return this.point.name + ' : ' + numberDisplay(this.point.y);
		                    },
		                    style: {
		                        color: (Highcharts.theme && Highcharts.theme.contrastTextColor) || 'black'
		                    }
		                }
		            }
		        };
				return plot ;
			};

			var lineplot_param = function(pTitle, pXTitle, f_pYTitle, s_pYTitle, pXCategories, pData) {
			 	max_sY = 0;
			 	max_fY = 0;
			 	for (var series_cur = 0; series_cur < pData[0]['data'].length ; series_cur++ ){
			 		if (pData[0]['data'][series_cur] > max_sY) {
			 			max_sY = pData[0]['data'][series_cur];
			 		}
			 		if (pData[1]['data'][series_cur] > max_fY) {
			 			max_fY = pData[1]['data'][series_cur];
			 		}
			 	}
				var chart = chartplot_line( pTitle, pXTitle, f_pYTitle, s_pYTitle, max_fY, max_sY, pXCategories, pData );
			 	chart['chart'] = { 
			 		type: 'line',
			 		zoomType:"x",
			 		selectionMarkerFill: frogsColorZoomHighCharts
			 	};
				chart['plotOptions'] = {
					area: {
						marker: {
							enabled: true,
							symbol: 'circle',radius:4,
						}
					}
				};
			 	return chart ;
			 }

			/////////// Line plot
			var step_nsti = ###STEP_NSTI### ;
			var series = [{
				'name': "Nb ASV",
				'data': ###CLUSTERS_SIZES###,
				'yAxis': 1,
			}, {
				'name': "Nb sequences (ASV size)",
				'data': ###ABUNDANCES_SIZES###
			}];
			var sum_series = new Array() ;

			var clusters_ditrib_load = function( container_id ) {

			var cluster_by_nsti = lineplot_param("", "NSTI value", "Nb kept sequences", "Nb kept ASVs", step_nsti, series);
			cluster_by_nsti['tooltip'] = {
				formatter:function() {
							max = this.points[1].series.data[this.points[1].series.data.length - 1].y ;
							tooltip_body = '' ;
							for( var i=0 ; i<this.points.length ; i++) {
								var pcnt = (this.points[1].point.y / max) * 100;
								tooltip_body += '<tr> ' +
									'<td style="color:' + this.points[i].series.color +'">' + this.points[i].series.name + ' :</td>' +
									'<td> ' + Highcharts.numberFormat(this.points[i].point.y, 0) + '  (' + Highcharts.numberFormat((this.points[i].point.y / this.points[i].series.data[this.points[i].series.data.length - 1].y) * 100, 1)+ '%) </td>'
								   '</tr>' ;
							}
							return '<table>' + tooltip_body + '</table>' ;
						},
						shared: true,
						useHTML: true
					},
			$('#' + container_id).append('<div></div>');
			$('#' + container_id).highcharts( cluster_by_nsti );
			$('#' + container_id).append('<p class="graph-nb">N.B.: Select area to zoom in.</p>');
			}
			///////////////
			$(function() {
				$(".frogsversion > a").text("FROGS "+frogs_tool+" "+frogs_version);
				
				var alignment_series = [];
				var coverage_series = [];

				for(var cluster in detection_series) {
					dict_a = {};
					dict_c = {};
					dict_a.name = detection_series[cluster].name;
					dict_c.name = detection_series[cluster].name;
					dict_a.x = parseFloat(detection_series[cluster].data[5]);
					dict_c.x = parseFloat(detection_series[cluster].data[5]);
					dict_a.y = parseFloat(detection_series[cluster].data[11].split(" ")[0]);
					dict_c.y = parseFloat(detection_series[cluster].data[12].split(" ")[0]);
					alignment_series.push(dict_a);
					coverage_series.push(dict_c);
				}
				// alert(JSON.stringify(scatter_series, null, 4));
				// Remove alert
				$('#js-alert').remove();
				$('#content').removeClass("hidden");
				
				// Radializes colors
				Highcharts.setOptions({
					 colors : [frogsColor, frogsColor2] ,
					 lang: {thousandsSep: ','}
					});
					Highcharts.SVGRenderer.prototype.symbols.download = function (x, y, w, h) {
					var path = [
						// Arrow stem
						'M', x + w * 0.5, y,
						'L', x + w * 0.5, y + h * 0.7,
						// Arrow head
						'M', x + w * 0.3, y + h * 0.5,
						'L', x + w * 0.5, y + h * 0.7,
						'L', x + w * 0.7, y + h * 0.5,
						// Box
						'M', x, y + h * 0.9,
						'L', x, y + h,
						'L', x + w, y + h,
						'L', x + w, y + h * 0.9
					];
					return path;
				};
				/* Radial gradient ?*/
			    Highcharts.getOptions().colors = Highcharts.map(Highcharts.getOptions().colors, function (color) {
			        return {
			            radialGradient: { cx: 0.5, cy: 0.3, r: 0.7 },
			            stops: [
			                [0, color],
			                [1, Highcharts.Color(color).brighten(-0.1).get('rgb')] // darken
			            ]
			        };
			    });
				
			 	// Display chimera remove data
				var nb_filtered_data = [
					['Inserted', remove_info['nb_kept']],
					['Removed', remove_info['nb_removed']]
				];
				$('#nb-filtered').highcharts( pie_param('Clusters', nb_filtered_data, 'Clusters') );
				var abundance_filtered_data = [
  					['Inserted', remove_info['abundance_kept']],
  					['Removed', remove_info['abundance_removed']]
  				];
				$('#abundance-filtered').highcharts( pie_param('Abundance', abundance_filtered_data, 'Sequences') );
				
				// Display chimera detection data
				var table_categories = detection_categories.slice() ;
				table_categories.unshift( "ASV" );
				var table_series = new Array();
				for( var spl_idx = 0 ; spl_idx < detection_series.length ; spl_idx++ ){
					var nb_by_step = detection_series[spl_idx]['data'].slice() ;
					nb_by_step.unshift( detection_series[spl_idx]['name'] );
					table_series.push( nb_by_step );
				};
				$('#filter-log').append( table("Chimera detection by sample", table_categories, table_series) );
				$('#filter-log table').prop( 'id', 'details-table' );
				$('#filter-log table').DataTable({
					dom:  	"<'#details-csv-export'><'row'<'col-sm-5'l><'col-sm-7'f>>" +
							"<'row'<'col-sm-12'tr>>" +
							"<'row'<'col-sm-5'i><'col-sm-7'p>>",
					'lengthMenu': [[10, 25, 50, 100, -1], [10, 25, 50, 100, "All"]],
				});
				$('#details-csv-export').html( '<button class="btn"><span class="fa fa-download" aria-hidden="true"> CSV</span></button>' );
				$('#details-csv-export').addClass( 'dataTables_filter' );
				$('#details-csv-export').datatableExport({
					'table_id': "details-table"
				});

				clusters_ditrib_load( "sequence-distrib" );


				Highcharts.chart('container_scatter', {
				chart: {
					type: 'scatter',
					zoomType: 'xy'
				},
				title: {
					text: ''
				},
				xAxis: {
					title: {
						enabled: true,
						text: 'NSTI value'
					},
					startOnTick: true,
					endOnTick: true,
					showLastLabel: true
				},
				yAxis: {
					title: {
						text: 'alignment metrics (%)'
					}
				},
				legend: {
					backgroundColor: Highcharts.defaultOptions.chart.backgroundColor,
				},
				plotOptions: {
					series : {
						turboThreshold: 0
					},
					scatter: {
						marker: {
							radius: 5,
							states: {
								hover: {
									enabled: true,
									lineColor: 'rgb(100,100,100)'
								}
							}
						},
						states: {
							hover: {
								marker: {
									enabled: false
								}
							}
						},
						tooltip: {
							headerFormat: '<b>{point.key}</b><br>',
							pointFormat: '{point.x}, {point.y}%'
						}
					}, 
						dataLabels: {
                    		format: "{point.key}",
                    		enabled: true
                	},
					enableMouseTracking: false
				},
				series: [{
					name: '% identity',
					color: 'rgba(134, 165, 164, .5)',
					data: alignment_series
					}, {
					name: '% coverage',
					color: 'rgba(211, 148, 104, .5)',
					data: coverage_series				
					}]
				})
			})
		</script>
	</head>
	<body>
		<!-- Alert -->
		<p id="js-alert" class="alert alert-warning">
			javascript is needed to display data.<br />
			If you try to view this data on galaxy please contact your administrator to authorise javascript or download the file to view.
		</p>
		
		<!-- Content -->
		<div id="content" class="hidden">
			<ul id="mytab" class="nav nav-tabs">
				<li class="nav-item frogsversion"><a class="nav-link"></a></li>
			</ul>
			<div id="filter-summary">
        		<h2 class="pb-2 mt-4 mb-2 border-bottom">Insertion in reference tree summary</h2>
        		<div class="row">
	        		<div id="nb-filtered" class="col-md-6"></div> 
	        		<div id="abundance-filtered" class="col-md-6"></div>
        		</div>
			</div>
			<div id="filter-log">
				<h2 class="pb-2 mt-4 mb-2 border-bottom">Closest reference sequences by ASV</h2>
			</div>
			<div class="tab-content">
				<h2 class="pb-2 mt-4 mb-2 border-bottom">ASV number according to NSTI threshold</h2>
				<div id="sequence-distrib" role="tabpanel" class="tab-pane active">
				</div>
			</div>
			<h2 class="pb-2 mt-4 mb-2 border-bottom"> %identity and coverage vs NSTI between kept ASV and closest PICRUSt2 reference sequence</h2>
			<div id="container_scatter"></div>
		</div>
	</body>
</html>
