<?xml version="1.0" encoding="UTF-8"?>
<!--
__author__ = ' Moussa Samb & Maria Bernard  & Geraldine Pascal INRAE - SIGENAE '
__copyright__ = 'Copyright (C) 2020 INRAE'
__license__ = 'GNU General Public License'
__version__ = '1.0'
__email__ = 'frogs@inrae.fr'
__status__ = 'dev'
-->
<tool id="FROGS_PICRUSt4_pathway" name="FPStep4" version= "beta">
	<description>Infer the presence and abundances of pathways based on gene family abundances in a sample. </description>

	<requirements>
               
        
    </requirements>

    <stdio>
        <exit_code range="1:" />
        <exit_code range=":-1" />
    </stdio>
	

    <command >   
       FPStep4.py
            --input_file $input_file
            --category $category
            --debug
            #if $is_per_sequence_contrib.per_sequence_contrib == "yes"
                --per_sequence_contrib
                --per_sequence_abun $per_sequence_abun
                --per_sequence_function $per_sequence_function 
            #end if
			#if $skip_descriptions
                --skip_descriptions
            #end if
	   		--html $html
	   		--debug
	</command> 

	<inputs>
	         
        <param format="tabular" name="input_file" type="data" label="FPStep3 prediction abundance file" help="Input TSV table of gene family abundances (either the unstratified or stratified output of FPStep3, by default pred_metagenome_unstrat.tsv)" optional="false">
            <validator type="empty_field" message="This parameter is required." />
        </param>
        <param name="category" type="select" label="Taxonomic marker" help="Taxonomic marker of interest." multiple="false" display="radio">
        	<option value="16S">16S</option>
        	<option value="ITS">ITS</option>
        	<option value="18S">18S</option>
		</param>
       <conditional name="is_per_sequence_contrib">
       <param name="per_sequence_contrib" type="select" label="Also produce table stratified by sequences ?" help='Also product the predicted pathway abundance contributed by each individual sequence. This is in contrast to the default stratified output, which is the contribution to the community-wide pathway abundances. Note this will greatly increase the runtime.' >
			<option value="no" selected="true">No</option>
			<option value="yes">Yes</option>
		</param>
       	<when value="yes">
       		<param name="per_sequence_abun" type="data" label="FPStep3 abundance per sequence file" help="Path to table of sequence abundances across samples normalized by marker copy number (FPStep3 output: seqtab_norm.tsv by default). This input is required when the --per_sequence_contrib option is set." optional="false">
            <validator type="empty_field" message="This parameter is required." />
            </param>
       		<param name="per_sequence_function" type="data" label="FPStep2 abundance function file" help="Path to table of function abundances per sequence, which was outputted at the FPStep2 (all_predicted.tsv by default). This input is required when the --per_sequence_contrib option is set." optional="false">
            <validator type="empty_field" message="This parameter is required." />
        	</param>
       	</when>
       </conditional>


        <param name="skip_descriptions" type="boolean" label="Skipping add_descriptions step " help='Skip adding descriptions of metabolic pathways in outputs files.' />
   
	</inputs>


	<outputs>
		<data format="html" name="html" label="${tool.name}: FPStep4_summary.html" from_work_dir="FPStep4_summary.html"/>
		 <data format="tabular" name="abund" label="${tool.name}: FPStep4_path_abun_unstrat.tsv" from_work_dir="FPStep4_path_abun_unstrat.tsv"/> 
         <data format="tabular" name="contrib" label="${tool.name}: FPStep4_path_abun_contrib.tsv" from_work_dir="FPStep4_path_abun_contrib.tsv"> 
            <filter>is_per_sequence_contrib['per_sequence_contrib'] == "yes"</filter>
         </data>
         <data format="tabular" name="predictions" label="${tool.name}: FPSTep4_path_abun_predictions.tsv" from_work_dir="FPSTep4_path_abun_predictions.tsv">
            <filter>is_per_sequence_contrib['per_sequence_contrib'] == "yes"</filter>
         </data>
		  
	</outputs>



     <help>
.. image:: ./static/images/frogs_images/FROGS_logo.png  
   :height: 144
   :width: 110

.. class:: infomark page-header h2

What it does

Prediction of functional abundances based solely on the sequences of marker genes with 'PICRUSt2 &lt;https://github.com/picrust/picrust2&gt;`_. 
The third step of Picrust2 Determine the abundance of gene families for each sample.


.. class:: infomark page-header h2

Inputs/Outputs

.. class:: h3

Input

**Prediction result per sample ** (function_predict.tsv):

 
The table of gene prediction for each cluster (format TSV).

Authorised column names :  sequence_OTU, function identifier, NSTI


.. class:: h3

Outputs

**Pathway Prediction result per sample ** (pathway.tsv):

 
The table with abundances each cluster in each sample for each cluster (format TSV).

Authorised column names :  .....



**Html file** (summary.html):
   
The summary file describing which OTUs are contained or not in the phylogenetic tree.

.. class:: infomark page-header h2

**Contact**

Contacts: frogs@inra.fr

website: http://frogs.toulouse.inra.fr/

Repository: https://github.com/geraldinepascal/FROGS
website: http://frogs.toulouse.inra.fr/

Please cite the **FROGS article**: *Escudie F., et al. Bioinformatics, 2018. FROGS: Find, Rapidly, OTUs with Galaxy Solution.*

Please cite the	**PICRUSt2 article**: * Gavin M. Douglas1, Vincent J. Maffei2, Jesse Zaneveld3, Svetlana N. Yurgel4, James R. Brown5, Christopher M. Taylor2, Curtis Huttenhower6, Morgan G. I. Langille1,7,*	

     </help>

    <citation>
    	<citation type="doi">10.1101/672295</citation>
 	</citation>
 </tool>
